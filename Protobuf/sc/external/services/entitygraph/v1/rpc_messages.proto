syntax = "proto3";

package sc.external.services.entitygraph.v1;

import "google/rpc/status.proto";
import "google/protobuf/timestamp.proto";
import "google/rpc/error_details.proto";
import "sc/external/common/api/v1/pagination.proto";
import "sc/external/common/game/v1/types.proto";
import "sc/external/services/entitygraph/v1/entity_commands.proto";
import "sc/external/services/entitygraph/v1/container_commands.proto";
import "sc/external/services/entitygraph/v1/inventory_commands.proto";
import "sc/external/services/entitygraph/v1/query.proto";
import "sc/external/services/entitygraph/v1/types.proto";
import "sc/external/common/api/v1/types.proto";
import "sc/external/common/network/v1/types.proto";

message EntityMutationStreamRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.EntityGraphCommand commands = 5;
}

message EntityMutationStreamResponseBody {
  string id = 1;
  bool success = 2;
  .google.rpc.Status status = 3;
  .sc.external.common.api.v1.ServiceOverloadControlMetrics metrics = 4;
}

message LoadAllRequestBody {
  string shard_id = 1;
}

message LoadAllResponseBody {
  repeated .sc.external.services.entitygraph.v1.EntityGraph graphs = 1;
  repeated .sc.external.services.entitygraph.v1.EntitySnapshot snapshots = 2;
}

message GetEntitiesOwnersRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  repeated string entity_ids = 2;
}

message GetEntitiesOwnersResponseBody {
  repeated .sc.external.services.entitygraph.v1.EntityOwner entity_owners = 1;
}

message ChangeInventoryConfigurationRequestBody {
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.ChangeInventoryConfigurationCommand command = 2;
}

message ChangeInventoryConfigurationResponseBody {}

message StowRequestBody {
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.StowCommand stow = 2;
  string from_shard_id = 3;
}

message StowResponseBody {
  string id = 1;
}

message UnstowRequestBody {
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.UnstowCommand unstow = 2;
  string to_shard_id = 3;
}

message UnstowResponseBody {
  string id = 1;
}

message BuryRequestBody {
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.BuryCommand bury = 2;
  .sc.external.services.entitygraph.v1.Scope from = 3;
}

message BuryResponseBody {
  string id = 1;
}

message SnapshotQueryRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.SnapshotQuery query = 2;
}

message SnapshotQueryResponseBody {
  repeated .sc.external.services.entitygraph.v1.SnapshotQueryResponseBody.EntitySnapshotResults results = 1;

  message EntitySnapshotResults {
    .sc.external.services.entitygraph.v1.EntitySnapshot snapshot = 1;
  }
}

message CreateMetaRecordsRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.MetaRecord records = 2;
}

message CreateMetaRecordsResponseBody {}

message QueryMetaRecordsRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.MetaRecordsQuery query = 2;
}

message QueryMetaRecordsResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  repeated .sc.external.services.entitygraph.v1.MetaRecord results = 2;
}

message EraseMetaRecordsRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.EraseMetaRecordsRequestBody.Body erasures = 2;

  message Body {
    string key = 1;
    string kind = 2;
    uint32 generation = 3;
  }
}

message EraseMetaRecordsResponseBody {}

message CreateEntityClassesRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.EntityClass entity_classes = 2;
}

message CreateEntityClassesResponseBody {}

message EraseEntityClassesRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.EraseEntityClassesRequestBody.Body erasures = 2;

  message Body {
    string guid = 1;
    uint32 generation = 2;
  }
}

message EraseEntityClassesResponseBody {}

message QueryEntityClassesRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.EntityClassesQuery query = 2;
}

message QueryEntityClassesResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  repeated .sc.external.services.entitygraph.v1.EntityClass results = 2;
}

message CreateShardRequestBody {
  uint32 generation = 1;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 2;
  string shard_id = 3;
  .sc.external.common.network.v1.Region region = 4;
  string host = 5;
}

message CreateShardResponseBody {
  .sc.external.services.entitygraph.v1.Shard shard = 1;
}

message DestroyShardRequestBody {
  string shard_id = 1;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 2;
}

message DestroyShardResponseBody {}

message GetShardRequestBody {
  string shard_id = 1;
}

message GetShardResponseBody {
  .sc.external.services.entitygraph.v1.Shard shard = 1;
}

message AcquireShardRequestBody {
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 1;
  repeated .sc.external.common.network.v1.Region regions = 2;
}

message AcquireShardResponseBody {
  .sc.external.services.entitygraph.v1.Shard shard = 1;
}

message ChangeShardStatusRequestBody {
  string shard_id = 1;
  .sc.external.services.entitygraph.v1.ShardStatus status = 2;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 3;
}

message ChangeShardStatusResponseBody {}

message StowShardRequestBody {
  string shard_id = 1;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 2;
  bool force = 3;
}

message StowShardResponseBody {
  uint32 stowed_player_count = 1;
  uint32 failed_player_count = 3;
  repeated .sc.external.services.entitygraph.v1.StowShardResponseBody.StowError player_errors = 5;
  uint32 stowed_entity_count = 7;
  uint32 failed_entity_count = 8;
  repeated .sc.external.services.entitygraph.v1.StowShardResponseBody.StowError entity_errors = 9;

  message StowError {
    string name = 1;
    string message = 2;
    string geid = 3;
  }
}

message QueryShardsRequestBody {
  .sc.external.services.entitygraph.v1.ShardQuery query = 1;
}

message QueryShardsResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  repeated .sc.external.services.entitygraph.v1.Shard results = 2;
}

message RepairShardRequestBody {
  string shard_id = 1;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 2;
  bool remove_orphaned_edges = 3;
  bool remove_orphaned_nodes = 4;
}

message RepairShardResponseBody {}

message RepairShardSchemaRequestBody {
  string shard_id = 1;
  .sc.external.services.entitygraph.v1.ShardArguments arguments = 2;
}

message RepairShardSchemaResponseBody {}

message MutateContainerGraphRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.ContainerGraphCommand commands = 2;
}

message MutateContainerGraphResponseBody {}

message ContainerMutationStreamRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.ContainerGraphCommand commands = 2;
}

message ContainerMutationStreamResponseBody {
  string id = 1;
  bool success = 2;
  .google.rpc.Status status = 3;
  .sc.external.common.api.v1.ServiceOverloadControlMetrics metrics = 4;
}

message ContainerQueryRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.ContainerGraphQuery query = 2;
}

message ContainerQueryResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  .sc.external.services.entitygraph.v1.ContainerGraph results = 2;
}

message ContainerQueryStreamRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.ContainerGraphStreamQuery query = 2;
  int32 batch_size = 3;
}

message ContainerQueryStreamResponseBody {
  .sc.external.services.entitygraph.v1.ContainerGraph results = 1;
}

message MoveRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.MoveCommand move = 2;
}

message MoveResponseBody {}

message GetInventoriesRequestBody {
  string owner_id = 1;
}

message GetInventoriesResponseBody {
  repeated .sc.external.services.entitygraph.v1.Node inventories = 1;
}

message EntityQueryRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.EntityGraphQuery query = 2;
}

message EntityQueryResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  .sc.external.services.entitygraph.v1.EntityGraph results = 2;
  repeated .sc.external.services.entitygraph.v1.EntitySnapshot snapshots = 3;
  repeated .sc.external.services.entitygraph.v1.EntityClass entity_classes = 4;
}

message EntityQueryStreamRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  .sc.external.services.entitygraph.v1.EntityGraphStreamQuery query = 2;
  int32 batch_size = 3;
}

message EntityQueryStreamResponseBody {
  .sc.external.services.entitygraph.v1.EntityGraph results = 1;
  repeated .sc.external.services.entitygraph.v1.EntitySnapshot snapshots = 2;
  repeated .sc.external.services.entitygraph.v1.EntityClass entity_classes = 3;
}

message MutateEntitiesRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.EntityGraphCommand commands = 5;
}

message MutateEntitiesResponseBody {}

message MutateInventoriesRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  repeated .sc.external.services.entitygraph.v1.InventoryCommand commands = 2;
}

message MutateInventoriesResponseBody {}

message InventoryQueryRequestBody {
  .sc.external.services.entitygraph.v1.InventoryQuery query = 1;
}

message InventoryQueryResponseBody {
  .sc.external.common.api.v1.PaginationInfo page_info = 1;
  repeated .sc.external.services.entitygraph.v1.Inventory results = 2;
}

message MeltRequestBody {
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.MeltCommand melt = 2;
}

message MeltResponseBody {}

message GetOverloadControlMetricsRequestBody {
  string shard_id = 1;
}

message GetOverloadControlMetricsResponseBody {
  .sc.external.common.api.v1.ServiceOverloadControlMetrics metrics = 1;
}

message GetEntitiesRootsRequestBody {
  .sc.external.services.entitygraph.v1.Scope scope = 1;
  repeated string entity_ids = 2;
  bool tree = 3;
  bool snapshots = 4;
  bool entity_classes = 5;
}

message GetEntitiesRootsResponseBody {
  repeated .sc.external.services.entitygraph.v1.GetEntitiesRootsResponseBody.Body entity_roots = 1;
  repeated .sc.external.services.entitygraph.v1.EntitySnapshot snapshots = 2;
  repeated .sc.external.services.entitygraph.v1.EntityClass entity_classes = 3;

  message Body {
    string entity_id = 1;
    .sc.external.services.entitygraph.v1.Node root = 2;
    .sc.external.services.entitygraph.v1.EntityGraph graph = 3;
  }
}

message MoveAllRequestBody {
  .sc.external.services.entitygraph.v1.MutationArguments arguments = 1;
  .sc.external.services.entitygraph.v1.MoveAllCommand move = 2;
}

message MoveAllResponseBody {}

message GetEntityStowContextsByGeidsRequestBody {
  repeated uint64 geids = 1;
  uint64 owner_id = 2;
  repeated uint32 entity_class_crcs = 3;
}

message GetEntityStowContextsByGeidsResponseBody {
  repeated .sc.external.services.entitygraph.v1.EntityStowContext results = 1;
}

message GetEntityStowContextsByParentUrnsRequestBody {
  repeated string parent_urns = 1;
  uint64 owner_id = 2;
  repeated uint32 entity_class_crcs = 3;
}

message GetEntityStowContextsByParentUrnsResponseBody {
  repeated .sc.external.services.entitygraph.v1.EntityStowContext results = 1;
}

message GetEntitiesByStowContextRequestBody {
  uint64 owner_id = 3;
  bool snapshots = 4;
  repeated .sc.external.services.entitygraph.v1.GetEntitiesByStowContextRequestBody.EntityIdentifier identifiers = 5;

  message EntityIdentifier {
    oneof identifier {
      uint64 entity_id = 1;
      string parent_urn = 2;
    }
  }
}

message GetEntitiesByStowContextResponseBody {
  repeated .sc.external.services.entitygraph.v1.Node results = 1;
  repeated .sc.external.services.entitygraph.v1.EntitySnapshot snapshots = 2;
}

message UpdateEntitiesByStowContextRequestBody {
  repeated .sc.external.services.entitygraph.v1.UpdateEntitiesByStowContextRequestBody.EntityUpdate entity_updates = 1;
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 2;
  uint64 owner_id = 3;

  message EntityUpdate {
    oneof identifier {
      uint64 entity_id = 1;
      string parent_urn = 2;
    }
    .sc.external.services.entitygraph.v1.UpdateEntitiesByStowContextRequestBody.EntityUpdate.OwnershipUpdate ownership_update = 3;
    .sc.external.services.entitygraph.v1.UpdateEntitiesByStowContextRequestBody.EntityUpdate.OwnershipStatusUpdate ownership_status_update = 4;
    .sc.external.services.entitygraph.v1.UpdateEntitiesByStowContextRequestBody.EntityUpdate.ParentUrnUpdate parent_urn_update = 5;
    bool update_ltp_records = 6;
    .sc.external.services.entitygraph.v1.UpdateEntitiesByStowContextRequestBody.EntityUpdate.LocationUpdate location_update = 7;

    message OwnershipUpdate {
      uint64 owner_id = 1;
    }
    message OwnershipStatusUpdate {
      .sc.external.common.game.v1.OwnershipStatus ownership_status = 1;
      .google.protobuf.Timestamp ownership_timestamp = 2;
    }
    message ParentUrnUpdate {
      string parent_urn = 1;
    }
    message LocationUpdate {
      uint32 location_id = 1;
    }
  }
}

message UpdateEntitiesByStowContextResponseBody {}

message SnapshotQueryByStowContextRequestBody {
  .sc.external.services.entitygraph.v1.SnapshotQuery query = 1;
  uint64 owner_id = 2;
}

message SnapshotQueryByStowContextResponseBody {
  repeated .sc.external.services.entitygraph.v1.SnapshotQueryByStowContextResponseBody.EntitySnapshotResults results = 1;

  message EntitySnapshotResults {
    .sc.external.services.entitygraph.v1.EntitySnapshot snapshot = 1;
  }
}

message ChangeSnapshotsByStowContextRequestBody {
  repeated .sc.external.services.entitygraph.v1.ChangeSnapshotsByStowContextRequestBody.Changes changes = 1;
  .sc.external.services.entitygraph.v1.TransMutationArguments arguments = 2;

  message Changes {
    uint64 entity_id = 1;
    .sc.external.services.entitygraph.v1.EntitySnapshot snapshot = 2;
    uint64 owner_id = 3;
  }
}

message ChangeSnapshotsByStowContextResponseBody {}

